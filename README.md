# av-snapshot
This is a fork of Cheesecookie's cc_snapshot, and works pretty much the same way 
cc_snapshot does:
* Upload a snapshot of your character's profile
* Show off your character to your friends
* ???
* Profit!

# Contents
1. [License](#license)
2. [Installation](#installation)
3. [Usage](#usage)
4. [Notes](#notes)
5. [Frequently Asked Questions](#frequently-asked-questions)

## License
[![License: CC BY-NC-SA 4.0](https://licensebuttons.net/l/by-nc-sa/4.0/80x15.png)](https://creativecommons.org/licenses/by-nc-sa/4.0/)
This work is licensed under a [Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License](http://creativecommons.org/licenses/by-nc-sa/4.0/).

## Installation

Run this command in the graphical CLI:
```
git checkout https://github.com/m-e-meyer/av-snapshot main
```
Will require [a recent build of KoLMafia](http://builds.kolmafia.us/job/Kolmafia/lastSuccessfulBuild/).

## Usage

Just enter `av-snapshot` into the gCLI.  It will gather and upload your information, and then tell you where you can visit your profile, a URL like `https://api.aventuristo.net/av-snapshot?u=<username>`.

The parameters for viewing snapshots are:
* `u=`: The name of the user for which the snapshot was taken.  This is the only parameter that is required.  If the name has spaces, and your browser doesn't handle them, you can substitute `+` or `%20` for each space.
* `colorblind=`: If `0` (the default if not given), colors boxes with greens and reds.  If `1`, colors boxes with blues and yellows.
* `noimages=`: If `0` (the default if not given), the page will be drawn with images.  If `1`, the page will be drawn without images, which may be faster and will certainly take fewer pages to print. 
* `oob=`: Stands for "on or before".  Takes a string of the form `yyyy-mm-dd`, where `yyyy` is the 4-digit year, `mm` is a month from `01` to `12`, and `dd` is a day from `01` to `31`.  If this parameter is not supplied or is empty, av-snapshot shows the most recent snapshot.  Otherwise, av-snapshot shows the most recent snapshot taken on or before the given date.  Partial dates can also be supplied; `2023-01` will give the last snapshot before the end of January 2023.
* `sections=`: Comma-delimited list of section names.  If not supplied or if empty, the entire snapshot is shown.  Otherwise, only the section names given will be shown.  If a named section has subsections, then all its subsections will be shown.  The entire section name does not need to be supplied; if the first few letters are given, then all sections with names beginning with those letters are shown.  For example, `f` will show the whole Familiars section, as well as Fishin' Gear and FantasyRealm under Cool Items, and Food under Consumption.
* `unicorn=`: Numeric.  If present and set to a nonzero value, displays page in unicorn mode.  Thanks to DeadNed 
(#1909053), whose exploit of an input validation failure (now patched) made this possible.

For eaxmple, `https://api.aventuristo.net/av-snapshot?u=mortigulo&oob=2022&sections=skil,fam` will show the Skills and Familiars sections of Mortigulo's last snapshot before the end of 2022.

## Notes
Sorry, you can't access cc_snapshot's stored profiles directly from api.aventuristo.net.  av-snapshot's backend was built from scratch, and uses a new database.  Web pages generated by av-snapshot have links to the cc_snapshot equivalent, though.

## Frequently Asked Questions

### Why isn't the Mr. Item that I know I have showing up?
Some items are unusual in that they open up places, so they don't appear in your inventory or in your Terrarium.  To detect these items, av-snapshot relies on the values of certain properties that should be set by Mafia.  If the property is set wrong, av-snapshot won't find it.  Sometimes it happens to people who have changed their names; perhaps the properties under the new names need to be updated.  Here are the properties used to find certain Mr. Items:
|Unlocked Place|Property|
|--------------|--------|
|11th Precinct Headquarters|`hasDetectiveSchool`|
|Autumn-aton|`hasAutumnaton`|
|Boxing Daycare|`daycareOpen`|
|Chateau Mantegna|`chateauAvailable`|
|Conspiracy Island|`spookyAirportAlways`|
|cosmic bowling ball|`hasCosmicBowlingBall`|
|Dinseylandfill|`stenchAirportAlways`|
|FantasyRealm|`frAlways`|
|Florist Friar|`ownsFloristFriar` (as of Mafia r27496)|
|Getaway Campsite|`getawayCampsiteUnlocked`|
|Gingerbread City|`gingerbreadCityAvailable`|
|The Glaciest|`coldAirportAlways`|
|Horsery|`horseryAvailable`|
|lovebug pheromones|`lovebugsUnlocked`|
|LT&T Office|`telegraphOfficeAvailable`|
|MayDay|`hasMaydayContract`|
|Neverending Party|`neverendingPartyAlways`|
|Oliver's Place|`ownsSpeakeasy`|
|PirateRealm|`prAlways`|
|Shrine to the Barrel god|`barrelShrineUnlocked`|
|The Snojo|`snojoAvailable`|
|Spacegate|`spacegateAlways`|
|Spring Break Beach|`sleazeAirportAlways`|
|That 70s Volcano|`hotAirportAlways`|
|Tunnel of L.O.V.E.|`loveTunnelAvailable`|
|Voting Booth|`voteAlways` (but see below)|

If you have Mr. Item above that doesn't show up, go to Mafia's graphical command-line interface (gCLI) and enter
```
set <property>=true
```
where `<property>` is the property in the table above for the place.  You should only have to do this once.

Note: Aliisza observed that, in Mafia r27956, if `voteToday` is `true`, Mafia sets `voteAlways` to `false`.  If you're not seeing your Voting Booth in your snapshot, you might want to check this.
